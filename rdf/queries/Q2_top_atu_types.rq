
# Purpose: Q2 â€” Distribution of ATU types (Top 20)

PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX skos:    <http://www.w3.org/2004/02/skos/core#>

SELECT ?atuConcept ?atuCode (COUNT(DISTINCT ?tale) AS ?taleCount)
WHERE {
  ?tale dcterms:subject ?atuConcept .

  OPTIONAL { ?atuConcept skos:notation ?atuCodeSkos . }
  BIND(
    COALESCE(
      STR(?atuCodeSkos),
      STRAFTER(STR(?atuConcept), "/rdf/taleType/atu/")
    ) AS ?atuCode
  )

  # safety: drop any subject URIs that are not ATU concepts (if you have other subjects)
  FILTER(STRSTARTS(STR(?atuConcept), "https://github.com/eugeniavd/magic_tagger/rdf/taleType/atu/"))
}
GROUP BY ?atuConcept ?atuCode
ORDER BY DESC(?taleCount) ?atuCode
LIMIT 20
